---
title: Auth Module
description: Built-in authentication module — identity, registration, login, OAuth, and password management.
---

The auth module owns identity management. It handles user registration, login, logout, password reset, and OAuth2 social login. Authorization (roles/permissions) belongs to the [RBAC module](/built-in-modules/rbac/).

## Features

- User registration with email + password
- Login / logout
- Password reset flow
- Two authentication strategies: Session (SCS) or JWT
- OAuth2 social login (Google, GitHub, Discord)
- Two password hashing options: argon2id (default, OWASP recommended) or bcrypt
- Exported `UserService` interface for DI
- 4 events emitted for other modules to react to

## Configuration

```toml
[modules.auth]
strategy = "session"       # "session", "jwt"
hasher = "argon2id"        # "argon2id" or "bcrypt"
session_ttl = "24h"
min_password_length = 12
jwt_secret = ""            # required if strategy=jwt
jwt_expiry = "1h"
```

### OAuth Configuration

When OAuth providers are enabled, users can sign in with their social accounts. OAuth works alongside session or JWT — the OAuth callback establishes a session or returns a token based on the configured strategy.

```toml
[modules.auth.oauth]
enabled = true
redirect_url = "http://localhost:4000"

[modules.auth.oauth.google]
client_id = ""
client_secret = ""

[modules.auth.oauth.github]
client_id = ""
client_secret = ""

[modules.auth.oauth.discord]
client_id = ""
client_secret = ""
```

Leave `client_id` and `client_secret` empty to disable a specific provider. Only providers with credentials are registered.

## HTTP Routes

| Method | Path | Description |
|--------|------|-------------|
| POST | `/auth/register` | Register a new user |
| POST | `/auth/login` | Authenticate and get token/session |
| POST | `/auth/logout` | End session / invalidate token |
| POST | `/auth/password-reset` | Request password reset |
| GET | `/auth/oauth/{provider}` | Redirect to OAuth provider (Google, GitHub, Discord) |
| GET | `/auth/oauth/{provider}/callback` | Handle OAuth callback, create/link user |

OAuth routes are only registered when at least one provider is configured with credentials.

## OAuth Flow

1. User clicks "Sign in with Google" (or GitHub, Discord)
2. Browser redirects to `/auth/oauth/google`
3. The handler generates a CSRF state token, stores it in a cookie, and redirects to Google's consent screen
4. Google redirects back to `/auth/oauth/google/callback` with an authorization code
5. The handler exchanges the code for an access token, fetches user info (email)
6. If the OAuth account is already linked, the user is logged in
7. If not, the module checks for an existing user with the same email. If none exists, a new user is created automatically
8. The OAuth account is linked to the user for future logins
9. The configured strategy (session or JWT) establishes the authenticated state

## UserService Interface

Exported for other modules via DI as `auth.user_service`:

```go
type UserService interface {
    Register(ctx context.Context, email, password string) (*User, error)
    Authenticate(ctx context.Context, email, password string) (*User, error)
    FindByID(ctx context.Context, id uuid.UUID) (*User, error)
    FindByEmail(ctx context.Context, email string) (*User, error)
}
```

## Authentication Strategies

### JWT Strategy

Stateless authentication using JSON Web Tokens. Best for APIs.

- Token returned in response body on login
- Client sends `Authorization: Bearer <token>` header
- No server-side session storage needed

### Session Strategy

Server-side sessions using SCS. Best for server-rendered apps.

- Session cookie set on login
- Server stores session data
- Automatic expiry based on `session_ttl`

## Events

| Event Name | Payload | When |
|-----------|---------|------|
| `auth.user_registered` | `*User` | After successful registration |
| `auth.user_logged_in` | `*User` | After successful login |
| `auth.user_logged_out` | `*User` | After logout |
| `auth.password_reset` | `*User` | After password reset |

## Middleware

- **RequireAuth** — verifies JWT token or session, injects user ID into request context
- **RequireGuest** — ensures the user is NOT authenticated

```go
authmw.RequireAuth(strategy, userService)
```

## CLI Commands

```bash
devify auth:create-admin <email> <password>
devify auth:list-users
```

## Database Tables

| Table | Schema |
|-------|--------|
| `auth.users` | id, email, password_hash, created_at, updated_at |
| `auth.password_resets` | id, user_id, token, expires_at, created_at |
| `auth.oauth_accounts` | id, user_id, provider, provider_id, created_at |
