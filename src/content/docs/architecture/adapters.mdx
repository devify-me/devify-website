---
title: Adapter System
description: Swappable infrastructure backends that implement kernel interfaces.
---

Adapters are concrete implementations of kernel interfaces. They live in the `adapters/` directory and are selected via configuration.

## Available Adapters

### Database

| Adapter | Engine | Isolation |
|---------|--------|-----------|
| `adapters/database/postgres` | PostgreSQL | Schema per module |
| `adapters/database/mysql` | MySQL / MariaDB | Table prefix |
| `adapters/database/sqlite` | SQLite | Table prefix |
| `adapters/database/mongodb` | MongoDB | Collection prefix |

### Cache

| Adapter | Backend | Use Case |
|---------|---------|----------|
| `adapters/cache/redis` | Redis | Production, shared cache |
| `adapters/cache/badger` | BadgerDB | Embedded, no external dependency |
| `adapters/cache/memory` | In-memory | Development, testing |

### Mail

| Adapter | Backend | Notes |
|---------|---------|-------|
| `adapters/mail/smtp` | SMTP with TLS/STARTTLS | Universal. Works with Mailpit for local dev |
| `adapters/mail/resend` | Resend API | Modern API, free tier (100 emails/day) |
| `adapters/mail/sendgrid` | Twilio SendGrid | Industry standard, free tier (100/day) |
| `adapters/mail/postmark` | Postmark | Best deliverability, transactional focus |
| `adapters/mail/ses` | Amazon SES | Cheapest at scale, uses AWS SDK |

All mail adapters implement the `kernel.Mailer` interface and fall back to log-only mode when credentials are missing — so your app always boots in development without configuration.

### Storage

| Adapter | Backend | Features |
|---------|---------|----------|
| `adapters/storage/local` | Local filesystem | Path-traversal prevention |
| `adapters/storage/s3` | AWS S3 / MinIO | Presigned URLs, custom endpoints, path-style addressing |
| `adapters/storage/sftp` | SFTP server | SSH key or password authentication |
| `adapters/storage/webdav` | WebDAV server | HTTP-based file access |

The S3 adapter supports MinIO and any S3-compatible service via the `endpoint` and `force_path_style` config fields.

### Router

| Adapter | Backend |
|---------|---------|
| `adapters/router/chi` | Chi HTTP router |

### Renderer

| Adapter | Backend |
|---------|---------|
| `adapters/renderer/templ` | Templ (type-safe templates) |
| `adapters/renderer/gotemplate` | Go standard library templates |

## How Adapters Are Wired

The generated `cmd/app/main.go` uses boot helpers from `cmd/internal/boot/` to create adapters based on configuration:

```go
cfg, _ := kernel.LoadConfig("config/config.toml")
logger := kernel.NewSlogLogger(cfg.GetString("app.log_level", "info"))
router := chiRouter.New()

// Adapters are created from config — engine is read from [database], [cache], etc.
db, _ := boot.CreateDatabase(cfg, logger)    // switches on database.engine
cache, _ := boot.CreateCache(cfg, logger)    // switches on cache.engine
mailer, _ := boot.CreateMailer(cfg, logger)  // switches on mail.engine
storage, _ := boot.CreateStorage(cfg, logger) // switches on storage.engine

// Wire into kernel
k, _ := kernel.NewKernel("config/config.toml",
    kernel.WithRouter(router),
    kernel.WithDatabase(db),
    kernel.WithCache(cache),
    kernel.WithMailer(mailer),
    kernel.WithStorage(storage),
    kernel.WithLogger(logger),
)
```

## Writing a Custom Adapter

To create a custom adapter, implement the relevant kernel interface:

```go
package myredis

import (
    "context"
    "time"
    "github.com/devify-tools/devify/kernel"
)

type MyCache struct {
    // your fields
}

// Implement kernel.Cache
func (c *MyCache) Get(ctx context.Context, key string) ([]byte, error) { /* ... */ }
func (c *MyCache) Set(ctx context.Context, key string, value []byte, ttl time.Duration) error { /* ... */ }
func (c *MyCache) Delete(ctx context.Context, key string) error { /* ... */ }
func (c *MyCache) Exists(ctx context.Context, key string) (bool, error) { /* ... */ }
func (c *MyCache) Close() error { /* ... */ }
```

Then wire it in `cmd/app/main.go`:

```go
cache := myredis.New(cfg, logger)
k, _ := kernel.NewKernel(configPath, kernel.WithCache(cache))
```
